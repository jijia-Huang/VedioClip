## ADDED Requirements

### Requirement: 片段匯出功能
系統 SHALL 提供功能讓使用者將定義的剪輯片段匯出為獨立的影片檔案。

#### Scenario: 設定匯出選項
- **WHEN** 使用者準備匯出片段
- **THEN** 可以選擇輸出目錄
- **AND** 可以選擇輸出格式（mp4, avi, mov, mkv 等）
- **AND** 可以選擇輸出品質（高、中、低）
- **AND** 顯示當前選擇的設定

#### Scenario: 選擇輸出目錄
- **WHEN** 使用者點擊選擇輸出目錄按鈕
- **THEN** 顯示輸出目錄選擇對話框
- **AND** 使用者可以選擇輸出目錄
- **AND** 如果取消選擇，保持當前設定或使用預設值

#### Scenario: 開始匯出
- **WHEN** 使用者選擇輸出目錄並確認
- **THEN** 開始批次匯出所有片段
- **AND** 顯示匯出進度
- **AND** 匯出按鈕被禁用

#### Scenario: 匯出進度顯示
- **WHEN** 正在匯出片段
- **THEN** 顯示當前匯出的片段名稱
- **AND** 顯示匯出進度（當前片段索引 / 總片段數）
- **AND** 顯示進度百分比

#### Scenario: 單一片段匯出成功
- **WHEN** 一個片段匯出完成
- **THEN** 進度更新
- **AND** 繼續處理下一個片段
- **AND** 記錄成功狀態

#### Scenario: 單一片段匯出失敗
- **WHEN** 一個片段匯出失敗
- **THEN** 記錄錯誤訊息
- **AND** 繼續處理下一個片段（不中止整個流程）
- **AND** 在最終結果中顯示失敗的片段

#### Scenario: 所有片段匯出完成
- **WHEN** 所有片段處理完成
- **THEN** 顯示匯出結果（成功數量、失敗數量）
- **AND** 匯出按鈕恢復可用
- **AND** 提供開啟輸出目錄的選項（可選）

### Requirement: 檔案名稱處理
系統 SHALL 自動生成輸出檔案名稱。

#### Scenario: 基於片段名稱生成檔案名稱
- **WHEN** 匯出片段
- **THEN** 使用片段名稱作為檔案名稱基礎
- **AND** 如果片段名稱為空，使用預設名稱（如 "clip_1"）
- **AND** 添加適當的副檔名（基於原始影片格式）

#### Scenario: 處理檔案名稱衝突
- **WHEN** 輸出目錄中已存在相同檔案名稱
- **THEN** 自動添加序號（如 "片段名稱_1.mp4"）
- **AND** 確保檔案名稱唯一

#### Scenario: 清理檔案名稱
- **WHEN** 生成檔案名稱
- **THEN** 移除或替換無效字元（如 / \ : * ? " < > |）
- **AND** 確保檔案名稱符合檔案系統規範

### Requirement: FFmpeg 剪輯操作
系統 SHALL 使用 FFmpeg 執行影片剪輯。

#### Scenario: 剪輯參數設定
- **WHEN** 匯出片段
- **THEN** 使用 `-ss` 參數設定開始時間
- **AND** 使用 `-t` 參數設定持續時間
- **AND** 根據選擇的輸出格式設定編碼器（如 mp4 使用 libx264）
- **AND** 根據選擇的輸出品質設定位元率或品質參數
- **AND** 輸出到指定的輸出目錄
- **AND** 使用選擇的格式作為檔案副檔名

#### Scenario: 輸出格式轉換
- **WHEN** 選擇的輸出格式與原始格式不同
- **THEN** FFmpeg 進行格式轉換
- **AND** 使用適當的編碼器（如 mp4 使用 libx264 + aac）
- **AND** 保持原始解析度和幀率

#### Scenario: 輸出品質設定
- **WHEN** 選擇輸出品質
- **THEN** 高品質：使用原始品質或高位元率（如 5000k）
- **AND** 中品質：使用中等位元率（如 2500k）
- **AND** 低品質：使用低位元率（如 1000k）
- **AND** 如果選擇原始格式且高品質，使用 `-c copy` 快速複製

#### Scenario: 剪輯成功
- **WHEN** FFmpeg 操作成功完成
- **THEN** 輸出檔案存在於指定位置
- **AND** 檔案大小大於 0
- **AND** 記錄成功狀態

#### Scenario: 剪輯失敗處理
- **WHEN** FFmpeg 操作失敗
- **THEN** 記錄錯誤訊息
- **AND** 不刪除已成功匯出的檔案
- **AND** 繼續處理其他片段

### Requirement: 匯出狀態管理
系統 SHALL 追蹤和管理匯出狀態。

#### Scenario: 匯出進行中
- **WHEN** 匯出正在進行
- **THEN** 匯出按鈕被禁用
- **AND** 顯示匯出進度
- **AND** 不允許開始新的匯出操作

#### Scenario: 匯出完成或取消
- **WHEN** 匯出完成或取消
- **THEN** 匯出按鈕恢復可用
- **AND** 清除進度顯示（或保留最終結果）
- **AND** 允許開始新的匯出操作

### Requirement: 錯誤處理
系統 SHALL 妥善處理匯出過程中的錯誤。

#### Scenario: 輸出目錄不存在
- **WHEN** 指定的輸出目錄不存在
- **THEN** 顯示錯誤訊息
- **AND** 不開始匯出流程

#### Scenario: 輸出目錄無寫入權限
- **WHEN** 輸出目錄無寫入權限
- **THEN** 顯示錯誤訊息
- **AND** 不開始匯出流程

#### Scenario: 磁碟空間不足
- **WHEN** 磁碟空間不足（可選檢查）
- **THEN** 顯示警告或錯誤訊息
- **AND** 根據實作決定是否繼續或中止

### Requirement: 匯出結果顯示
系統 SHALL 在匯出完成後顯示結果摘要。

#### Scenario: 顯示匯出結果
- **WHEN** 所有片段處理完成
- **THEN** 顯示成功匯出的片段數量
- **AND** 顯示失敗的片段數量（如果有）
- **AND** 顯示失敗片段的錯誤訊息（如果有）
- **AND** 提供查看輸出目錄的選項（可選）
